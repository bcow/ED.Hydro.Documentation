<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Key Leaf Traits | Calculating ED Hydro Parameter Priors</title>
  <meta name="description" content="ED Hydro Documentation" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Key Leaf Traits | Calculating ED Hydro Parameter Priors" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://bcow.github.io/ED.Hydro.Documentation/" />
  
  <meta property="og:description" content="ED Hydro Documentation" />
  <meta name="github-repo" content="bcow/ED.Hydro.Documentation" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Key Leaf Traits | Calculating ED Hydro Parameter Priors" />
  
  <meta name="twitter:description" content="ED Hydro Documentation" />
  

<meta name="author" content="Betsy Cowdery" />


<meta name="date" content="2020-06-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="constants.html"/>
<link rel="next" href="key-wood-traits.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Documentation</a></li>
<li class="chapter" data-level="" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i>Setup</a><ul>
<li class="chapter" data-level="" data-path="setup.html"><a href="setup.html#choosing-pfts"><i class="fa fa-check"></i>Choosing PFTs</a></li>
<li class="chapter" data-level="0.1" data-path="setup.html"><a href="setup.html#pft-ed_tropical_hydro"><i class="fa fa-check"></i><b>0.1</b> PFT: ED_Tropical_Hydro</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="constants.html"><a href="constants.html"><i class="fa fa-check"></i>Constants</a><ul>
<li><a href="constants.html#wdns-liquid-water-density"><code>[wdns]:</code> Liquid water density</a></li>
<li><a href="constants.html#grav-gravity"><code>[grav]:</code> Gravity</a></li>
<li><a href="constants.html#mpa2m-conversion-from-mpa-to-m"><code>[MPa2m]:</code> Conversion from MPa to m</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html"><i class="fa fa-check"></i>Key Leaf Traits</a><ul>
<li><a href="key-leaf-traits.html#sla-specific-leaf-area-sla"><code>[SLA]:</code> Specific Leaf Area (SLA)</a></li>
<li><a href="key-leaf-traits.html#leaf_psi_osmotic-leaf-osmotic-water-potential-at-saturation"><code>[leaf_psi_osmotic]:</code> Leaf osmotic water potential at saturation</a><ul>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#ed"><i class="fa fa-check"></i>ED</a></li>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#bety"><i class="fa fa-check"></i>BETY</a></li>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#calculation"><i class="fa fa-check"></i>Calculation</a></li>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#code"><i class="fa fa-check"></i>Code</a></li>
</ul></li>
<li><a href="key-leaf-traits.html#leaf_elastic_mod-leaf-bulk-elastic-modulus"><code>[leaf_elastic_mod]</code>: Leaf bulk elastic modulus</a><ul>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#ed-1"><i class="fa fa-check"></i>ED</a></li>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#bety-1"><i class="fa fa-check"></i>BETY</a></li>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#calculation-1"><i class="fa fa-check"></i>Calculation</a></li>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#code-1"><i class="fa fa-check"></i>Code</a></li>
</ul></li>
<li><a href="key-leaf-traits.html#leaf_density-density-of-leaf-tissue"><code>[leaf_density]:</code> Density of leaf tissue</a><ul>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#ed-2"><i class="fa fa-check"></i>ED</a></li>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#bety-2"><i class="fa fa-check"></i>BETY</a></li>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#calculation-2"><i class="fa fa-check"></i>Calculation</a></li>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#code-2"><i class="fa fa-check"></i>Code</a></li>
</ul></li>
<li><a href="key-leaf-traits.html#leaf_water_sat-leaf-water-content-at-saturation"><code>[leaf_water_sat]:</code> Leaf water content at saturation</a><ul>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#ed-3"><i class="fa fa-check"></i>ED</a></li>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#bety-3"><i class="fa fa-check"></i>BETY</a></li>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#calculation-3"><i class="fa fa-check"></i>Calculation</a></li>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#code-3"><i class="fa fa-check"></i>Code</a></li>
</ul></li>
<li><a href="key-leaf-traits.html#leaf_psi_tlp-leaf-water-potential-at-turgor-loss-point"><code>[leaf_psi_tlp]:</code> Leaf water potential at turgor loss point</a><ul>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#ed-4"><i class="fa fa-check"></i>ED</a></li>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#bety-4"><i class="fa fa-check"></i>BETY</a></li>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#calculation-4"><i class="fa fa-check"></i>Calculation</a></li>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#code-4"><i class="fa fa-check"></i>Code</a></li>
</ul></li>
<li><a href="key-leaf-traits.html#leaf_water_cap-leaf-hydaulic-capacitance."><code>[leaf_water_cap]:</code> Leaf hydaulic capacitance.</a><ul>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#ed-5"><i class="fa fa-check"></i>ED</a></li>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#bety-5"><i class="fa fa-check"></i>BETY</a></li>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#calculation-5"><i class="fa fa-check"></i>Calculation</a></li>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#code-5"><i class="fa fa-check"></i>Code</a></li>
</ul></li>
<li><a href="key-leaf-traits.html#leaf_psi_min-leaf-minimum-water-potential"><code>[leaf_psi_min]:</code> Leaf minimum water potential</a><ul>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#ed-6"><i class="fa fa-check"></i>ED</a></li>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#bety-6"><i class="fa fa-check"></i>BETY</a></li>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#calculation-6"><i class="fa fa-check"></i>Calculation</a></li>
<li class="chapter" data-level="" data-path="key-leaf-traits.html"><a href="key-leaf-traits.html#code-6"><i class="fa fa-check"></i>Code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html"><i class="fa fa-check"></i>Key Wood Traits</a><ul>
<li><a href="key-wood-traits.html#wood_density-wood-density"><code>[wood_density]:</code> Wood density</a></li>
<li><a href="key-wood-traits.html#wood_psi_osmotic-sapwood-osmotic-water-potential-at-saturation"><code>[wood_psi_osmotic]:</code> Sapwood osmotic water potential at saturation</a><ul>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#ed-7"><i class="fa fa-check"></i>ED</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#bety-7"><i class="fa fa-check"></i>BETY</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#calculation-7"><i class="fa fa-check"></i>Calculation</a></li>
</ul></li>
<li><a href="key-wood-traits.html#wood_elastic_mod-sapwood-bulk-elastic-modulus"><code>[wood_elastic_mod]:</code> Sapwood bulk elastic modulus</a><ul>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#ed-8"><i class="fa fa-check"></i>ED</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#bety-8"><i class="fa fa-check"></i>BETY</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#calculation-8"><i class="fa fa-check"></i>Calculation</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#code-8"><i class="fa fa-check"></i>Code</a></li>
</ul></li>
<li><a href="key-wood-traits.html#wood_water_sat-sapwood-water-content-at-saturation"><code>[wood_water_sat]:</code> Sapwood water content at saturation</a><ul>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#ed-9"><i class="fa fa-check"></i>ED</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#bety-9"><i class="fa fa-check"></i>BETY</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#calculation-9"><i class="fa fa-check"></i>Calculation</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#code-9"><i class="fa fa-check"></i>Code</a></li>
</ul></li>
<li><a href="key-wood-traits.html#wood_psi_tlp-sapwood-water-potential-at-turgor-loss-point"><code>[wood_psi_tlp]:</code> Sapwood water potential at turgor loss point</a><ul>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#ed-10"><i class="fa fa-check"></i>ED</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#bety-10"><i class="fa fa-check"></i>BETY</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#calculation-10"><i class="fa fa-check"></i>Calculation</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#code-10"><i class="fa fa-check"></i>Code</a></li>
</ul></li>
<li><a href="key-wood-traits.html#wood_water_cap-wood-hydaulic-capacitance"><code>[wood_water_cap]:</code> Wood hydaulic capacitance</a><ul>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#ed-11"><i class="fa fa-check"></i>ED</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#bety-11"><i class="fa fa-check"></i>BETY</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#calculation-11"><i class="fa fa-check"></i>Calculation</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#code-11"><i class="fa fa-check"></i>Code</a></li>
</ul></li>
<li><a href="key-wood-traits.html#wood_psi_min-sapwood-minimum-relative-water-content-or-sapwood-residual-fraction"><code>[wood_psi_min]:</code> Sapwood minimum relative water content or Sapwood residual fraction</a><ul>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#ed-12"><i class="fa fa-check"></i>ED</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#bety-12"><i class="fa fa-check"></i>BETY</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#calculation-12"><i class="fa fa-check"></i>Calculation</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#code-12"><i class="fa fa-check"></i>Code</a></li>
</ul></li>
<li><a href="key-wood-traits.html#wood_kmax-maximum-hydraulic-conductivity-of-the-stem"><code>[wood_Kmax]:</code> Maximum hydraulic conductivity of the stem</a><ul>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#ed-13"><i class="fa fa-check"></i>ED</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#bety-13"><i class="fa fa-check"></i>BETY</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#calculation-13"><i class="fa fa-check"></i>Calculation</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#code-13"><i class="fa fa-check"></i>Code</a></li>
</ul></li>
<li><a href="key-wood-traits.html#wood_psi50-water-potential-at-which-50-of-stem-conductivity-is-lost"><code>[wood_psi50]:</code> Water potential at which 50% of stem conductivity is lost</a><ul>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#ed-14"><i class="fa fa-check"></i>ED</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#bety-14"><i class="fa fa-check"></i>BETY</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#calculation-14"><i class="fa fa-check"></i>Calculation</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#code-14"><i class="fa fa-check"></i>Code</a></li>
</ul></li>
<li><a href="key-wood-traits.html#ax-slope-of-xylem-vulnerability-curve-at-p50"><code>[ax]:</code> Slope of xylem vulnerability curve at P50</a><ul>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#ed-15"><i class="fa fa-check"></i>ED</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#bety-15"><i class="fa fa-check"></i>BETY</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#calculation-15"><i class="fa fa-check"></i>Calculation</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#code-15"><i class="fa fa-check"></i>Code</a></li>
</ul></li>
<li><a href="key-wood-traits.html#wood_kexp-exponent-for-the-hydraulic-vulnerability-curve-of-stem-conductivity"><code>[wood_Kexp]:</code> Exponent for the hydraulic vulnerability curve of stem conductivity</a><ul>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#ed-16"><i class="fa fa-check"></i>ED</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#bety-16"><i class="fa fa-check"></i>BETY</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#calculation-16"><i class="fa fa-check"></i>Calculation</a></li>
<li class="chapter" data-level="" data-path="key-wood-traits.html"><a href="key-wood-traits.html#code-16"><i class="fa fa-check"></i>Code</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Calculating ED Hydro Parameter Priors</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="key-leaf-traits" class="section level1 unnumbered">
<h1>Key Leaf Traits</h1>
<div id="sla-specific-leaf-area-sla" class="section level2 unnumbered">
<h2><code>[SLA]:</code> Specific Leaf Area (SLA)</h2>
<p>And subsequently <span class="math inline">\(LMA = (1/SLA)\)</span></p>
<ul>
<li>ED variable name : <code>SLA</code></li>
<li>ED variable id: 15</li>
</ul>
<p>There are multiple priors available for SLA so we are explicitly choosing prior <code>142</code> (this was chosen by someone else when the PFT was created.)</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">t =<span class="st"> &quot;SLA&quot;</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">t_long =<span class="st"> &quot;Specific Leaf Area &quot;</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">traits[[t]] &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">  <span class="dt">variable_name =</span> t,</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">  <span class="dt">variable_id =</span>  pfts_priors <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(var_name <span class="op">==</span><span class="st"> </span>t) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(variable_id),</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">  <span class="dt">prior_id =</span> pfts_priors <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(var_name <span class="op">==</span><span class="st"> </span>t) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(id),</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">  <span class="dt">fit =</span> pfts_priors <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(var_name <span class="op">==</span><span class="st"> </span>t) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="st">&quot;distn&quot;</span>, <span class="st">&quot;parama&quot;</span>, <span class="st">&quot;paramb&quot;</span>)</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb9-10" data-line-number="10"></a>
<a class="sourceLine" id="cb9-11" data-line-number="11">traits[[t]]<span class="op">$</span>prior =<span class="st"> </span><span class="kw">rdistn</span>(traits[[t]]<span class="op">$</span>fit)</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">traits[[t]]<span class="op">$</span>default =<span class="st"> </span><span class="kw">get_ED_default</span>(PFT3_defaults_history, t)</a>
<a class="sourceLine" id="cb9-13" data-line-number="13"></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="kw">prior_plot</span>(<span class="dt">prior =</span> traits[[t]]<span class="op">$</span>prior, </a>
<a class="sourceLine" id="cb9-15" data-line-number="15">           <span class="dt">plot_default =</span> traits[[t]]<span class="op">$</span>default,</a>
<a class="sourceLine" id="cb9-16" data-line-number="16">           <span class="dt">title =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s(%s):</span><span class="ch">\n</span><span class="st">%s(%.4f, %.4f)&quot;</span>, t_long, t, </a>
<a class="sourceLine" id="cb9-17" data-line-number="17">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>distn, </a>
<a class="sourceLine" id="cb9-18" data-line-number="18">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>parama,</a>
<a class="sourceLine" id="cb9-19" data-line-number="19">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>paramb),</a>
<a class="sourceLine" id="cb9-20" data-line-number="20">           <span class="dt">type =</span> <span class="st">&quot;prior&quot;</span>)</a></code></pre></div>
<p><img src="Final_Book_files/figure-html/SLA-1.png" width="672" /></p>
<hr />
</div>
<div id="leaf_psi_osmotic-leaf-osmotic-water-potential-at-saturation" class="section level2 unnumbered">
<h2><code>[leaf_psi_osmotic]:</code> Leaf osmotic water potential at saturation</h2>
<div id="ed" class="section level3 unnumbered">
<h3>ED</h3>
<ul>
<li>ED variable name : <code>leaf_psi_osmotic</code></li>
<li>ED variable units: <code>m</code></li>
</ul>
</div>
<div id="bety" class="section level3 unnumbered">
<h3>BETY</h3>
<p>NOTE!! The units are NEGATIVE in the database
so we can calculate a distribution that is entirely negative.</p>
<ul>
<li>Variable id: <code>1000000295</code></li>
<li>Prior id: <code>1000000388</code></li>
</ul>
</div>
<div id="calculation" class="section level3 unnumbered">
<h3>Calculation</h3>
<div id="expert-elicitation" class="section level4 unnumbered">
<h4>Expert elicitation</h4>
<p>Expert elicitation provided by Brad Christoffersen</p>
<ul>
<li>FATES varaiable name: <code>pinot_node (leaf)</code></li>
<li>FATES variable units: <code>MPa</code></li>
</ul>
</div>
<div id="conversion" class="section level4 unnumbered">
<h4>Conversion</h4>
<p><code>MPa to m</code></p>
</div>
</div>
<div id="code" class="section level3 unnumbered">
<h3>Code</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">t =<span class="st"> &quot;leaf_psi_osmotic&quot;</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">t_long =<span class="st"> &quot;Leaf osmotic water potential at saturation &quot;</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"></a>
<a class="sourceLine" id="cb10-4" data-line-number="4">i &lt;-<span class="st"> </span><span class="kw">which</span>(priors<span class="op">$</span>ED_name <span class="op">==</span><span class="st"> </span>t)</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">prior_in &lt;-<span class="st"> </span>priors[i, stats] <span class="op">*</span><span class="st"> </span>C<span class="op">$</span>MPa2m</a>
<a class="sourceLine" id="cb10-6" data-line-number="6"></a>
<a class="sourceLine" id="cb10-7" data-line-number="7">traits &lt;-<span class="st"> </span><span class="kw">fit_trait_dist</span>(bety, traits, t, prior_in, accepted_dists)</a></code></pre></div>
<p><img src="Final_Book_files/figure-html/calc%20leaf_psi_osmotic-1.png" width="672" /></p>
<pre><code>## Entry with id = 1000000388 already exists.
## Parameters look the saaaaame.
## Old: weibull(2.4100, 237.4600)
## New: weibull(2.4100, 237.4600)</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">traits[[t]]<span class="op">$</span>prior =<span class="st"> </span><span class="dv">-1</span> <span class="op">*</span><span class="st"> </span><span class="kw">rdistn</span>(traits[[t]]<span class="op">$</span>fit)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">traits[[t]]<span class="op">$</span>default =<span class="st"> </span><span class="kw">get_ED_default</span>(PFT3_defaults_history, t)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="kw">prior_plot</span>(<span class="dt">prior =</span> traits[[t]]<span class="op">$</span>prior, </a>
<a class="sourceLine" id="cb12-5" data-line-number="5">           <span class="dt">plot_default =</span> traits[[t]]<span class="op">$</span>default,</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">           <span class="dt">title =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s(%s):</span><span class="ch">\n</span><span class="st">%s(%.4f, %.4f)&quot;</span>, t_long, t, </a>
<a class="sourceLine" id="cb12-7" data-line-number="7">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>distn, </a>
<a class="sourceLine" id="cb12-8" data-line-number="8">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>parama,</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>paramb),</a>
<a class="sourceLine" id="cb12-10" data-line-number="10">           <span class="dt">type =</span> <span class="st">&quot;elic&quot;</span>)</a></code></pre></div>
<p><img src="Final_Book_files/figure-html/plot%20leaf_psi_osmotic-1.png" width="672" /></p>
<hr />
</div>
</div>
<div id="leaf_elastic_mod-leaf-bulk-elastic-modulus" class="section level2 unnumbered">
<h2><code>[leaf_elastic_mod]</code>: Leaf bulk elastic modulus</h2>
<div id="ed-1" class="section level3 unnumbered">
<h3>ED</h3>
<ul>
<li>ED variable name : <code>leaf_elastic_mod</code></li>
<li>ED variable units: <code>MPa</code> Note! This is the only case in which MPa is used instead of m!</li>
</ul>
</div>
<div id="bety-1" class="section level3 unnumbered">
<h3>BETY</h3>
<ul>
<li>Variable id: <code>1000000294</code></li>
<li>Prior id: <code>1000000387</code></li>
</ul>
</div>
<div id="calculation-1" class="section level3 unnumbered">
<h3>Calculation</h3>
<div id="expert-elicitation-1" class="section level4 unnumbered">
<h4>Expert elicitation</h4>
<p>Expert elicitation provided by Brad Christoffersen</p>
<ul>
<li>FATES varaiable name: <code>epsil_node (leaf)</code></li>
<li>FATES variable units: <code>MPa</code></li>
</ul>
</div>
<div id="conversion-1" class="section level4 unnumbered">
<h4>Conversion</h4>
<p>None!</p>
</div>
</div>
<div id="code-1" class="section level3 unnumbered">
<h3>Code</h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">t =<span class="st"> &quot;leaf_elastic_mod&quot;</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">t_long =<span class="st"> &quot;Leaf bulk elastic modulus &quot;</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"></a>
<a class="sourceLine" id="cb13-4" data-line-number="4">i &lt;-<span class="st"> </span><span class="kw">which</span>(priors<span class="op">$</span>ED_name <span class="op">==</span><span class="st"> </span>t)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">prior_in &lt;-<span class="st"> </span>priors[i,]</a>
<a class="sourceLine" id="cb13-6" data-line-number="6"></a>
<a class="sourceLine" id="cb13-7" data-line-number="7">traits &lt;-<span class="st"> </span><span class="kw">fit_trait_dist</span>(bety, traits, t, prior_in, accepted_dists)</a></code></pre></div>
<p><img src="Final_Book_files/figure-html/calc%20leaf_elastic_mod-1.png" width="672" /></p>
<pre><code>## Entry with id = 1000000387 already exists.
## Parameters look the saaaaame.
## Old: gamma(3.4400, 0.1600)
## New: gamma(3.4400, 0.1600)</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">traits[[t]]<span class="op">$</span>prior =<span class="st"> </span><span class="kw">rdistn</span>(traits[[t]]<span class="op">$</span>fit)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">traits[[t]]<span class="op">$</span>default =<span class="st"> </span><span class="kw">get_ED_default</span>(PFT3_defaults_history, t)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="kw">prior_plot</span>(<span class="dt">prior =</span> traits[[t]]<span class="op">$</span>prior, </a>
<a class="sourceLine" id="cb15-5" data-line-number="5">           <span class="dt">q =</span> <span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">999</span>), </a>
<a class="sourceLine" id="cb15-6" data-line-number="6">           <span class="dt">plot_default =</span> traits[[t]]<span class="op">$</span>default,</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">           <span class="dt">title =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s(%s):</span><span class="ch">\n</span><span class="st">%s(%.4f, %.4f)&quot;</span>, t_long, t, </a>
<a class="sourceLine" id="cb15-8" data-line-number="8">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>distn, </a>
<a class="sourceLine" id="cb15-9" data-line-number="9">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>parama,</a>
<a class="sourceLine" id="cb15-10" data-line-number="10">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>paramb),</a>
<a class="sourceLine" id="cb15-11" data-line-number="11">           <span class="dt">type =</span> <span class="st">&quot;elic&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: Removed 100 rows containing non-finite values (stat_density).</code></pre>
<p><img src="Final_Book_files/figure-html/plot%20leaf_elastic_mod-1.png" width="672" /></p>
<hr />
</div>
</div>
<div id="leaf_density-density-of-leaf-tissue" class="section level2 unnumbered">
<h2><code>[leaf_density]:</code> Density of leaf tissue</h2>
<div id="ed-2" class="section level3 unnumbered">
<h3>ED</h3>
<ul>
<li>ED variable name : <code>leaf_density</code></li>
<li>ED variable units: <code>kg m-3</code></li>
</ul>
</div>
<div id="bety-2" class="section level3 unnumbered">
<h3>BETY</h3>
<ul>
<li>Variable id: <code>1000000304</code></li>
<li>Prior id: <code>1000000396</code></li>
</ul>
</div>
<div id="calculation-2" class="section level3 unnumbered">
<h3>Calculation</h3>
<div id="expert-elicitation-2" class="section level4 unnumbered">
<h4>Expert elicitation</h4>
<p>No expert elicitation provided by Brad Christoffersen.</p>
<p>I will use the equation in ED to calcualte the prior and
add min and max values to make sure the distribution
does not predict values that are not biologically possible.</p>
<p>Copies directly from the ED code: <code>max(0.1 * 1.e3, (leaf_elastic_mod(ipft) - 2.03) / 25.4 * 1.e3)</code></p>
<p>But there is a key step here that we need to think about, which is that in the ED code, <code>0.1 * 1.e3</code> is the smallest possible value. I encorporate that information by setting <code>0.1 * 1.e3</code> as the min theoretical value when fitting the distribution (but remove the <code>max</code> from the equation when calculating the <code>leaf_density_sample</code>.)</p>
<p><code>leaf_density_sample &lt;- (leaf_elastic_mod_prior - 2.03) / 25.4 * 1.e3</code></p>
<p>Values added by Betsy and Felicien:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">t =<span class="st"> &quot;leaf_density&quot;</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2">t_long =<span class="st"> &quot;Density of leaf tissue &quot;</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"></a>
<a class="sourceLine" id="cb17-4" data-line-number="4">i &lt;-<span class="st"> </span><span class="kw">which</span>(priors<span class="op">$</span>ED_name <span class="op">==</span><span class="st"> &quot;leaf_density&quot;</span>)</a>
<a class="sourceLine" id="cb17-5" data-line-number="5"></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="co"># Leaf_density</span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7">priors[i,<span class="kw">c</span>(<span class="st">&quot;theor.min&quot;</span>, <span class="st">&quot;theor.max&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">1e-7</span>, <span class="dv">2000</span>)</a>
<a class="sourceLine" id="cb17-8" data-line-number="8"></a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="co"># Does it make more sense to do what the ED code does??? </span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="co"># Turns out it doesn&#39;t change the parameters ... so maybe I&#39;ll do that</span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11">priors[i,<span class="kw">c</span>(<span class="st">&quot;theor.min&quot;</span>, <span class="st">&quot;theor.max&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">1e-3</span>, <span class="dv">2000</span>)</a></code></pre></div>
</div>
<div id="conversion-2" class="section level4 unnumbered">
<h4>Conversion</h4>
<p>None</p>
</div>
</div>
<div id="code-2" class="section level3 unnumbered">
<h3>Code</h3>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">temp_leaf_density_sample &lt;-<span class="st"> </span>(traits[[<span class="st">&quot;leaf_elastic_mod&quot;</span>]]<span class="op">$</span>prior <span class="op">-</span><span class="st"> </span><span class="fl">2.03</span>) <span class="op">/</span><span class="st"> </span><span class="fl">25.4</span> <span class="op">*</span><span class="st"> </span><span class="dv">1</span>.e3</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="co"># Add in the max an min from the priors table</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4">prior_in &lt;-<span class="st"> </span>priors[i,] <span class="co"># Note here I don&#39;t need to do any units conversion </span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5">prior_in &lt;-<span class="st"> </span><span class="kw">prior_add_samp_data</span>(prior_in, <span class="dt">samp =</span> temp_leaf_density_sample)</a>
<a class="sourceLine" id="cb18-6" data-line-number="6">prior_in[,stats]</a></code></pre></div>
<pre><code>## # A tibble: 1 x 7
##   theor.min low.025 low.25  mean upp.75 upp.975 theor.max
##       &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
## 1     0.001    118.   434.  688.  1018.   1858.      2000</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">traits &lt;-<span class="st"> </span><span class="kw">fit_trait_dist</span>(bety, traits, t, prior_in, accepted_dists)</a></code></pre></div>
<p><img src="Final_Book_files/figure-html/calc%20leaf_density_sample-1.png" width="672" /></p>
<pre><code>## Entry with id = 1000000396 already exists.
## Parameters look different.
## Old: weibull(1.8300, 845.2500)
## New: weibull(1.8300, 848.8400)</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">traits[[t]]<span class="op">$</span>prior =<span class="st"> </span><span class="kw">rdistn</span>(traits[[t]]<span class="op">$</span>fit)</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">traits[[t]]<span class="op">$</span>default =<span class="st"> </span>(<span class="kw">get_ED_default</span>(<span class="st">&quot;/fs/data3/ecowdery/ED.Hydro/parameters/pft3_defaults_history.xml&quot;</span>, <span class="st">&quot;leaf_elastic_mod&quot;</span>) <span class="op">-</span><span class="st"> </span><span class="fl">2.03</span>) <span class="op">/</span><span class="st"> </span><span class="fl">25.4</span> <span class="op">*</span><span class="st"> </span><span class="dv">1</span>.e3</a>
<a class="sourceLine" id="cb22-3" data-line-number="3"></a>
<a class="sourceLine" id="cb22-4" data-line-number="4"><span class="kw">prior_plot</span>(<span class="dt">prior =</span> traits[[t]]<span class="op">$</span>prior, </a>
<a class="sourceLine" id="cb22-5" data-line-number="5">           <span class="dt">q =</span> <span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">995</span>), </a>
<a class="sourceLine" id="cb22-6" data-line-number="6">           <span class="dt">plot_default =</span> traits[[t]]<span class="op">$</span>default,</a>
<a class="sourceLine" id="cb22-7" data-line-number="7">           <span class="dt">title =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s(%s):</span><span class="ch">\n</span><span class="st">%s(%.4f, %.4f)&quot;</span>, t_long, t, </a>
<a class="sourceLine" id="cb22-8" data-line-number="8">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>distn, </a>
<a class="sourceLine" id="cb22-9" data-line-number="9">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>parama,</a>
<a class="sourceLine" id="cb22-10" data-line-number="10">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>paramb),</a>
<a class="sourceLine" id="cb22-11" data-line-number="11">           <span class="dt">type =</span> <span class="st">&quot;mixed&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: Removed 500 rows containing non-finite values (stat_density).</code></pre>
<p><img src="Final_Book_files/figure-html/plot%20leaf_density_sample-1.png" width="672" /></p>
<hr />
</div>
</div>
<div id="leaf_water_sat-leaf-water-content-at-saturation" class="section level2 unnumbered">
<h2><code>[leaf_water_sat]:</code> Leaf water content at saturation</h2>
<div id="ed-3" class="section level3 unnumbered">
<h3>ED</h3>
<ul>
<li>ED variable name : <code>leaf_water_sat</code></li>
<li>ED variable units: <code>kg H2O/kg biomass</code></li>
</ul>
</div>
<div id="bety-3" class="section level3 unnumbered">
<h3>BETY</h3>
<ul>
<li>Variable id: <code>1000000285</code></li>
<li>Prior id: <code>1000000414</code></li>
</ul>
</div>
<div id="calculation-3" class="section level3 unnumbered">
<h3>Calculation</h3>
<p>There are a couple ways to approach this:</p>
<p>Either build a prior completely from other priors
(ie using the equations from ED and a prior for LMA and leaf_density)
or try to do a combination where we use the priovided expert elicitation
and the prior distribution for leaf_density.</p>
<p>I am going to try doing both just to see how they differ.</p>
<div id="expert-elicitation-3" class="section level4 unnumbered">
<h4>Expert elicitation</h4>
<p>Expert elicitation provided by Brad Christoffersen</p>
<ul>
<li>FATES varaiable name: <code>thetas_node (leaf)</code></li>
<li>FATES variable units: <code>kg kg-1</code></li>
</ul>
</div>
<div id="conversion-3" class="section level4 unnumbered">
<h4>Conversion</h4>
<p>The equations between the two are identical except that to get from
FATES to ED, must multiply by <code>(water density)/(leaf density)</code></p>
</div>
</div>
<div id="code-3" class="section level3 unnumbered">
<h3>Code</h3>
<div id="initial-testing-code" class="section level4 unnumbered">
<h4>Initial testing code</h4>
<p>From this point, we can see that just using the equations in the ED code makes
the distributions predict low values which is could be a problem given that
these values should not be zero and that the distribution underpredicts both
in relation to the default value and the values that Felicien gave me.</p>
<p>Thus I would create the prior using the expert elicitation values provided by Brad.</p>
</div>
<div id="actual-code" class="section level4 unnumbered">
<h4>Actual code</h4>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">t =<span class="st"> &quot;leaf_water_sat&quot;</span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2">t_long =<span class="st"> &quot;Leaf water content at saturation &quot;</span></a>
<a class="sourceLine" id="cb24-3" data-line-number="3">i &lt;-<span class="st"> </span><span class="kw">which</span>(priors<span class="op">$</span>ED_name <span class="op">==</span><span class="st"> </span>t)</a>
<a class="sourceLine" id="cb24-4" data-line-number="4">temp_myfit_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="kw">prior_get_fit</span>(priors[i,], accepted_dists, <span class="dt">plot =</span> <span class="ot">FALSE</span>)  </a>
<a class="sourceLine" id="cb24-5" data-line-number="5"></a>
<a class="sourceLine" id="cb24-6" data-line-number="6">temp_myfit_<span class="dv">0</span><span class="op">$</span>score<span class="op">$</span>dist[<span class="kw">which.min</span>(temp_myfit_<span class="dv">0</span><span class="op">$</span>score<span class="op">$</span>RMSE)]</a></code></pre></div>
<pre><code>## [1] &quot;norm&quot;</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="co"># I&#39;m skipping steps here just for the sake of time &amp; sanity</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2">temp_leaf_water_sat_prior_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100000</span>, temp_myfit_<span class="dv">0</span><span class="op">$</span>dists<span class="op">$</span>norm[<span class="dv">1</span>], temp_myfit_<span class="dv">0</span><span class="op">$</span>dists<span class="op">$</span>norm[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb26-3" data-line-number="3"></a>
<a class="sourceLine" id="cb26-4" data-line-number="4">temp_leaf_water_sat_sample &lt;-<span class="st"> </span>temp_leaf_water_sat_prior_<span class="dv">0</span> <span class="op">*</span><span class="st"> </span>(C<span class="op">$</span>wdns<span class="op">/</span>(traits[[<span class="st">&quot;leaf_density&quot;</span>]]<span class="op">$</span>prior))</a>
<a class="sourceLine" id="cb26-5" data-line-number="5"></a>
<a class="sourceLine" id="cb26-6" data-line-number="6"><span class="co"># plot(density(temp_leaf_water_sat_sample), main = &quot;leaf water sat sample without fitting&quot;)</span></a>
<a class="sourceLine" id="cb26-7" data-line-number="7"></a>
<a class="sourceLine" id="cb26-8" data-line-number="8"><span class="co"># In this case I&#39;m not using the function I built because here it wouldn&#39;t make sense. </span></a>
<a class="sourceLine" id="cb26-9" data-line-number="9">prior_in &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb26-10" data-line-number="10">  <span class="dt">theor.min =</span> <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb26-11" data-line-number="11">  <span class="dt">low.025 =</span>  <span class="kw">quantile</span>(temp_leaf_water_sat_sample, <span class="kw">c</span>(.<span class="dv">025</span>), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb26-12" data-line-number="12">  <span class="dt">low.25  =</span>  <span class="kw">quantile</span>(temp_leaf_water_sat_sample, <span class="kw">c</span>(.<span class="dv">25</span>), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb26-13" data-line-number="13">  <span class="dt">mean    =</span>  <span class="kw">quantile</span>(temp_leaf_water_sat_sample, <span class="kw">c</span>(.<span class="dv">5</span>), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), </a>
<a class="sourceLine" id="cb26-14" data-line-number="14">  <span class="dt">upp.75  =</span>  <span class="kw">quantile</span>(temp_leaf_water_sat_sample, <span class="kw">c</span>(.<span class="dv">75</span>), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), </a>
<a class="sourceLine" id="cb26-15" data-line-number="15">  <span class="dt">upp.975 =</span>  <span class="kw">quantile</span>(temp_leaf_water_sat_sample, <span class="kw">c</span>(.<span class="dv">975</span>), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb26-16" data-line-number="16">  <span class="dt">theor.max =</span> <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb26-17" data-line-number="17"></a>
<a class="sourceLine" id="cb26-18" data-line-number="18">traits &lt;-<span class="st"> </span><span class="kw">fit_trait_dist</span>(bety, traits, t, prior_in, accepted_dists)</a></code></pre></div>
<p><img src="Final_Book_files/figure-html/calc%20leaf_water_sat-1.png" width="672" /></p>
<pre><code>## Entry with id = 1000000414 already exists.
## Parameters look the saaaaame.
## Old: lnorm(-0.0400, 0.6400)
## New: lnorm(-0.0400, 0.6400)</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">traits[[t]]<span class="op">$</span>prior =<span class="st"> </span><span class="kw">rdistn</span>(traits[[t]]<span class="op">$</span>fit)</a>
<a class="sourceLine" id="cb28-2" data-line-number="2">traits[[t]]<span class="op">$</span>default =<span class="st"> </span><span class="kw">get_ED_default</span>(PFT3_defaults_history, t)</a>
<a class="sourceLine" id="cb28-3" data-line-number="3"></a>
<a class="sourceLine" id="cb28-4" data-line-number="4"><span class="kw">prior_plot</span>(<span class="dt">prior =</span> traits[[t]]<span class="op">$</span>prior, </a>
<a class="sourceLine" id="cb28-5" data-line-number="5">           <span class="dt">q =</span> <span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">995</span>), </a>
<a class="sourceLine" id="cb28-6" data-line-number="6">           <span class="dt">plot_default =</span> traits[[t]]<span class="op">$</span>default,</a>
<a class="sourceLine" id="cb28-7" data-line-number="7">           <span class="dt">title =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s(%s):</span><span class="ch">\n</span><span class="st">%s(%.4f, %.4f)&quot;</span>, t_long, t, </a>
<a class="sourceLine" id="cb28-8" data-line-number="8">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>distn, </a>
<a class="sourceLine" id="cb28-9" data-line-number="9">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>parama,</a>
<a class="sourceLine" id="cb28-10" data-line-number="10">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>paramb),</a>
<a class="sourceLine" id="cb28-11" data-line-number="11">           <span class="dt">type =</span> <span class="st">&quot;mixed&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: Removed 500 rows containing non-finite values (stat_density).</code></pre>
<p><img src="Final_Book_files/figure-html/plot%20leaf_water_sat-1.png" width="672" /></p>
<hr />
</div>
</div>
</div>
<div id="leaf_psi_tlp-leaf-water-potential-at-turgor-loss-point" class="section level2 unnumbered">
<h2><code>[leaf_psi_tlp]:</code> Leaf water potential at turgor loss point</h2>
<div id="ed-4" class="section level3 unnumbered">
<h3>ED</h3>
<ul>
<li>ED variable name : <code>leaf_psi_tlp</code></li>
<li>ED variable units: <code>m</code></li>
</ul>
</div>
<div id="bety-4" class="section level3 unnumbered">
<h3>BETY</h3>
<ul>
<li>Variable id: <code>1000000284</code></li>
<li>Prior id: <code>1000000384</code></li>
</ul>
<p>NOTE!! The units are NEGATIVE in the database
so we can calculate a distribution that is entirely negative.</p>
</div>
<div id="calculation-4" class="section level3 unnumbered">
<h3>Calculation</h3>
<div id="expert-elicitation-4" class="section level4 unnumbered">
<h4>Expert elicitation</h4>
<p>No expert elicitation provided by Brad Christoffersen.</p>
<p>I will use the equation in ED to calcualte the prior and
add min and max values to make sure the distribution
does not predict values that are not biologically possible.</p>
<p>Values added by Betsy and Felicien:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">t =<span class="st"> &quot;leaf_psi_tlp&quot;</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2">t_long =<span class="st"> &quot;Leaf water potential at turgor loss point &quot;</span></a>
<a class="sourceLine" id="cb30-3" data-line-number="3">i &lt;-<span class="st"> </span><span class="kw">which</span>(priors<span class="op">$</span>ED_name <span class="op">==</span><span class="st"> </span>t)</a>
<a class="sourceLine" id="cb30-4" data-line-number="4"></a>
<a class="sourceLine" id="cb30-5" data-line-number="5">priors[i, stats]</a></code></pre></div>
<pre><code>## # A tibble: 1 x 7
##   theor.min low.025 low.25  mean upp.75 upp.975 theor.max
##       &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
## 1       0.5      NA     NA    NA     NA      NA         6</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="co"># priors[which(priors$ED_name == &quot;leaf_psi_tlp&quot;),</span></a>
<a class="sourceLine" id="cb32-2" data-line-number="2">       <span class="co"># c(&quot;theor.min&quot;, &quot;theor.max&quot;)] &lt;- c(-6, -0.5)</span></a>
<a class="sourceLine" id="cb32-3" data-line-number="3"><span class="co"># priors[i,c(&quot;theor.min&quot;, &quot;theor.max&quot;)] &lt;- c(0.5, 6)</span></a></code></pre></div>
<p>Code directly from ED: <code>leaf_elastic_mod(ipft)  * (leaf_psi_osmotic(ipft) / C$MPa2m) / (leaf_elastic_mod(ipft) + leaf_psi_osmotic(ipft) / C$MPa2m) * C$MPa2m</code></p>
<p>Thus, <code>leaf_psi_tlp</code> is calculated purely from other parameters: <code>leaf_psi_osmotic</code> and <code>leaf_elastic_mod</code></p>
<pre><code>temp_leaf_psi_tlp_samp &lt;- 
  (leaf_psi_osmotic_prior * (leaf_elastic_mod_prior * C$MPa2m))/
  (leaf_psi_osmotic_prior + (leaf_elastic_mod_prior * C$MPa2m))</code></pre>
</div>
<div id="conversion-4" class="section level4 unnumbered">
<h4>Conversion</h4>
<p>Remember that <code>leaf_elastic_mod</code> is <code>MPa</code>, where everything else is <code>m</code>!</p>
</div>
</div>
<div id="code-4" class="section level3 unnumbered">
<h3>Code</h3>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">temp_leaf_psi_tlp_samp &lt;-</a>
<a class="sourceLine" id="cb34-2" data-line-number="2">(traits[[<span class="st">&quot;leaf_psi_osmotic&quot;</span>]]<span class="op">$</span>prior <span class="op">*</span><span class="st"> </span>(traits[[<span class="st">&quot;leaf_elastic_mod&quot;</span>]]<span class="op">$</span>prior <span class="op">*</span><span class="st"> </span>C<span class="op">$</span>MPa2m))<span class="op">/</span></a>
<a class="sourceLine" id="cb34-3" data-line-number="3">(traits[[<span class="st">&quot;leaf_psi_osmotic&quot;</span>]]<span class="op">$</span>prior <span class="op">+</span><span class="st"> </span>(traits[[<span class="st">&quot;leaf_elastic_mod&quot;</span>]]<span class="op">$</span>prior <span class="op">*</span><span class="st"> </span>C<span class="op">$</span>MPa2m))</a>
<a class="sourceLine" id="cb34-4" data-line-number="4"></a>
<a class="sourceLine" id="cb34-5" data-line-number="5"><span class="co"># Add in the max an min from the priors table</span></a>
<a class="sourceLine" id="cb34-6" data-line-number="6">i &lt;-<span class="st"> </span><span class="kw">which</span>(priors<span class="op">$</span>ED_name <span class="op">==</span><span class="st"> </span>t)</a>
<a class="sourceLine" id="cb34-7" data-line-number="7">prior_in &lt;-<span class="st"> </span>priors[i,stats] <span class="op">*</span><span class="st"> </span>C<span class="op">$</span>MPa2m <span class="co"># Convert from MPa to m</span></a>
<a class="sourceLine" id="cb34-8" data-line-number="8">prior_in &lt;-<span class="st"> </span><span class="kw">prior_add_samp_data</span>(prior_in, <span class="dt">samp =</span> <span class="op">-</span>temp_leaf_psi_tlp_samp)</a>
<a class="sourceLine" id="cb34-9" data-line-number="9">prior_in[,stats]</a></code></pre></div>
<pre><code>##     theor.min low.025      low.25        mean      upp.75 upp.975   theor.max
## 1 50.98581065      NA 153.6700345 231.8867672 326.1701485      NA 611.8297278</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">myfit &lt;-<span class="st"> </span><span class="kw">prior_get_fit</span>(prior_in, accepted_dists, <span class="dt">plot =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="Final_Book_files/figure-html/calc%20leaf_psi_tlp-1.png" width="672" /></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">variable_id.in &lt;-<span class="st"> </span><span class="kw">tbl</span>(bety,<span class="st">&quot;variables&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb37-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(name <span class="op">==</span><span class="st"> </span><span class="op">!!</span>priors<span class="op">$</span>ED_name[i]) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb37-3" data-line-number="3"><span class="st">  </span><span class="kw">pull</span>(id)</a>
<a class="sourceLine" id="cb37-4" data-line-number="4">phylogeny.in &lt;-<span class="st"> &quot;plants&quot;</span></a>
<a class="sourceLine" id="cb37-5" data-line-number="5"></a>
<a class="sourceLine" id="cb37-6" data-line-number="6">best.fit.name &lt;-<span class="st"> </span>myfit<span class="op">$</span>score<span class="op">$</span>dist[<span class="kw">which.min</span>(myfit<span class="op">$</span>score<span class="op">$</span>RMSE)]</a>
<a class="sourceLine" id="cb37-7" data-line-number="7">best.fit.dat &lt;-<span class="st"> </span>myfit<span class="op">$</span>dists <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb37-8" data-line-number="8"><span class="st">  </span><span class="kw">select</span>(<span class="kw">one_of</span>(<span class="st">&quot;Name&quot;</span>, best.fit.name)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb37-9" data-line-number="9"><span class="st">  </span><span class="kw">rename</span>(value <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="op">!!</span>best.fit.name, <span class="dt">params =</span> Name)</a>
<a class="sourceLine" id="cb37-10" data-line-number="10"></a>
<a class="sourceLine" id="cb37-11" data-line-number="11"></a>
<a class="sourceLine" id="cb37-12" data-line-number="12">traits &lt;-<span class="st"> </span><span class="kw">fit_trait_dist</span>(bety, traits, t, prior_in, accepted_dists)</a></code></pre></div>
<p><img src="Final_Book_files/figure-html/calc%20leaf_psi_tlp-2.png" width="672" /></p>
<pre><code>## Entry with id = 1000000384 already exists.
## Parameters look different.
## Old: lnorm(5.4200, 0.5300)
## New: lnorm(5.4200, 0.5400)</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">traits[[t]]<span class="op">$</span>prior =<span class="st"> </span><span class="dv">-1</span> <span class="op">*</span><span class="st"> </span><span class="kw">rdistn</span>(traits[[t]]<span class="op">$</span>fit) <span class="co"># Remember to flip back over for psi</span></a>
<a class="sourceLine" id="cb39-2" data-line-number="2">traits[[t]]<span class="op">$</span>default =<span class="st"> </span><span class="kw">get_ED_default</span>(PFT3_defaults_history, t)</a>
<a class="sourceLine" id="cb39-3" data-line-number="3"></a>
<a class="sourceLine" id="cb39-4" data-line-number="4"><span class="kw">prior_plot</span>(<span class="dt">prior =</span> traits[[t]]<span class="op">$</span>prior, </a>
<a class="sourceLine" id="cb39-5" data-line-number="5">           <span class="dt">q =</span> <span class="kw">c</span>(.<span class="dv">005</span>,<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb39-6" data-line-number="6">           <span class="dt">plot_default =</span> traits[[t]]<span class="op">$</span>default,</a>
<a class="sourceLine" id="cb39-7" data-line-number="7">           <span class="dt">title =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s(%s):</span><span class="ch">\n</span><span class="st">%s(%.4f, %.4f)&quot;</span>, t_long, t, </a>
<a class="sourceLine" id="cb39-8" data-line-number="8">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>distn, </a>
<a class="sourceLine" id="cb39-9" data-line-number="9">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>parama,</a>
<a class="sourceLine" id="cb39-10" data-line-number="10">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>paramb),</a>
<a class="sourceLine" id="cb39-11" data-line-number="11">           <span class="dt">type =</span> <span class="st">&quot;mixed&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: Removed 500 rows containing non-finite values (stat_density).</code></pre>
<p><img src="Final_Book_files/figure-html/plot%20leaf_psi_tlp-1.png" width="672" /></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw">prior_plot</span>(<span class="dt">prior =</span> traits[[t]]<span class="op">$</span>prior <span class="op">*</span><span class="st"> </span>(<span class="op">-</span><span class="dv">1</span><span class="op">/</span>C<span class="op">$</span>MPa2m), </a>
<a class="sourceLine" id="cb41-2" data-line-number="2">           <span class="dt">q =</span> <span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">995</span>),</a>
<a class="sourceLine" id="cb41-3" data-line-number="3">           <span class="dt">plot_default =</span> traits[[t]]<span class="op">$</span>default <span class="op">*</span><span class="st"> </span>(<span class="op">-</span><span class="dv">1</span><span class="op">/</span>C<span class="op">$</span>MPa2m),</a>
<a class="sourceLine" id="cb41-4" data-line-number="4">           <span class="dt">title =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s(%s):</span><span class="ch">\n</span><span class="st">%s(%.4f, %.4f)&quot;</span>, t_long, t, </a>
<a class="sourceLine" id="cb41-5" data-line-number="5">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>distn, </a>
<a class="sourceLine" id="cb41-6" data-line-number="6">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>parama,</a>
<a class="sourceLine" id="cb41-7" data-line-number="7">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>paramb),</a>
<a class="sourceLine" id="cb41-8" data-line-number="8">           <span class="dt">type =</span> <span class="st">&quot;mixed&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: Removed 500 rows containing non-finite values (stat_density).</code></pre>
<p><img src="Final_Book_files/figure-html/plot%20leaf_psi_tlp-2.png" width="672" /></p>
<hr />
</div>
</div>
<div id="leaf_water_cap-leaf-hydaulic-capacitance." class="section level2 unnumbered">
<h2><code>[leaf_water_cap]:</code> Leaf hydaulic capacitance.</h2>
<div id="ed-5" class="section level3 unnumbered">
<h3>ED</h3>
<ul>
<li>ED variable name : <code>leaf_water_cap</code></li>
<li>ED variable units: <code>kg H2O/kg biomass/m</code></li>
</ul>
</div>
<div id="bety-5" class="section level3 unnumbered">
<h3>BETY</h3>
<ul>
<li>Variable id: <code>1000000287</code></li>
<li>Prior id: <code>1000000405</code></li>
</ul>
<p>NOTE: units in BETY are <code>g H2O / kg biomass / m</code>! This is because we needed to multiply by 1000 to get large enough values to fit the distribution.</p>
</div>
<div id="calculation-5" class="section level3 unnumbered">
<h3>Calculation</h3>
<div id="expert-elicitation-5" class="section level4 unnumbered">
<h4>Expert elicitation</h4>
<p>No expert elicitation provided by Brad Christoffersen.</p>
<p>I will use the equation in ED to calcualte the prior and
add min and max values to make sure the distribution
does not predict values that are not biologically possible.</p>
<p>Values added by Betsy and Felicien:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1">t =<span class="st"> &quot;leaf_water_cap&quot;</span></a>
<a class="sourceLine" id="cb43-2" data-line-number="2">t_long =<span class="st"> &quot;Leaf hydaulic capacitance &quot;</span></a>
<a class="sourceLine" id="cb43-3" data-line-number="3">priors[<span class="kw">which</span>(priors<span class="op">$</span>ED_name <span class="op">==</span><span class="st"> &quot;leaf_water_cap&quot;</span>),</a>
<a class="sourceLine" id="cb43-4" data-line-number="4">       <span class="kw">c</span>(<span class="st">&quot;theor.min&quot;</span>, <span class="st">&quot;theor.max&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">1e-7</span>, <span class="ot">NA</span>)</a></code></pre></div>
<p>Equation copied directly from ED: <code>(1. - leaf_psi_osmotic(ipft) / (4. * leaf_psi_tlp(ipft))) * leaf_water_sat(ipft) / (4. * abs(leaf_psi_tlp(ipft)))</code></p>
</div>
<div id="conversion-5" class="section level4 unnumbered">
<h4>Conversion</h4>
<p>Don’t forget about the switch from kg to g!</p>
</div>
</div>
<div id="code-5" class="section level3 unnumbered">
<h3>Code</h3>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="co"># leaf_water_cap_samp &lt;- </span></a>
<a class="sourceLine" id="cb44-2" data-line-number="2"><span class="co">#   1000 * (1 - leaf_psi_osmotic_prior / (4 * leaf_psi_tlp_prior)) * </span></a>
<a class="sourceLine" id="cb44-3" data-line-number="3"><span class="co">#   (leaf_water_sat_prior / (4 * abs(leaf_psi_tlp_prior))) # * (C$wdns/leaf_density_prior)</span></a>
<a class="sourceLine" id="cb44-4" data-line-number="4"><span class="co"># </span></a>
<a class="sourceLine" id="cb44-5" data-line-number="5"><span class="co"># leaf_water_cap_samp &lt;- leaf_water_cap_samp[0 &lt; leaf_water_cap_samp]</span></a>
<a class="sourceLine" id="cb44-6" data-line-number="6"></a>
<a class="sourceLine" id="cb44-7" data-line-number="7"></a>
<a class="sourceLine" id="cb44-8" data-line-number="8">temp_leaf_water_cap_samp &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb44-9" data-line-number="9"><span class="st">  </span><span class="dv">1000</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>traits[[<span class="st">&quot;leaf_psi_osmotic&quot;</span>]]<span class="op">$</span>prior <span class="op">/</span><span class="st"> </span>(<span class="dv">4</span> <span class="op">*</span><span class="st"> </span>traits[[<span class="st">&quot;leaf_psi_tlp&quot;</span>]]<span class="op">$</span>prior)) <span class="op">*</span><span class="st"> </span></a>
<a class="sourceLine" id="cb44-10" data-line-number="10"><span class="st">  </span>(traits[[<span class="st">&quot;leaf_water_sat&quot;</span>]]<span class="op">$</span>prior <span class="op">/</span><span class="st"> </span>(<span class="dv">4</span> <span class="op">*</span><span class="st"> </span><span class="kw">abs</span>(traits[[<span class="st">&quot;leaf_psi_tlp&quot;</span>]]<span class="op">$</span>prior))) <span class="co"># * (C$wdns/traits[[&quot;leaf_density&quot;]]$prior)</span></a>
<a class="sourceLine" id="cb44-11" data-line-number="11"></a>
<a class="sourceLine" id="cb44-12" data-line-number="12">temp_leaf_water_cap_samp &lt;-<span class="st"> </span>temp_leaf_water_cap_samp[<span class="dv">0</span> <span class="op">&lt;</span><span class="st"> </span>temp_leaf_water_cap_samp]</a>
<a class="sourceLine" id="cb44-13" data-line-number="13"></a>
<a class="sourceLine" id="cb44-14" data-line-number="14"><span class="co"># Add in the max an min from the priors table</span></a>
<a class="sourceLine" id="cb44-15" data-line-number="15">i &lt;-<span class="st"> </span><span class="kw">which</span>(priors<span class="op">$</span>ED_name <span class="op">==</span><span class="st"> &quot;leaf_water_cap&quot;</span>)</a>
<a class="sourceLine" id="cb44-16" data-line-number="16">prior_in &lt;-<span class="st"> </span>priors[i,stats] </a>
<a class="sourceLine" id="cb44-17" data-line-number="17">prior_in[,<span class="st">&quot;theor.min&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb44-18" data-line-number="18"><span class="co"># prior_in[,&quot;theor.max&quot;] &lt;- max(.35 * (1/C$MPa2m) * (C$wdns/leaf_density_prior) )</span></a>
<a class="sourceLine" id="cb44-19" data-line-number="19">prior_in &lt;-<span class="st"> </span><span class="kw">prior_add_samp_data</span>(prior_in, <span class="dt">samp =</span> temp_leaf_water_cap_samp)</a>
<a class="sourceLine" id="cb44-20" data-line-number="20">prior_in[,stats]</a></code></pre></div>
<pre><code>## # A tibble: 1 x 7
##   theor.min low.025 low.25  mean upp.75 upp.975 theor.max
##   &lt;lgl&gt;       &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
## 1 NA          0.161  0.450 0.750   1.24    3.28        NA</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1">traits &lt;-<span class="st"> </span><span class="kw">fit_trait_dist</span>(bety, traits, t, prior_in, accepted_dists)</a></code></pre></div>
<p><img src="Final_Book_files/figure-html/calc%20leaf_water_cap-1.png" width="672" /></p>
<pre><code>## Entry with id = 1000000405 already exists.
## Parameters look the saaaaame.
## Old: lnorm(-0.2900, 0.7600)
## New: lnorm(-0.2900, 0.7600)</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1">traits[[t]]<span class="op">$</span>prior =<span class="st"> </span><span class="kw">rdistn</span>(traits[[t]]<span class="op">$</span>fit) <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">/</span><span class="dv">1000</span>) <span class="co"># Convert back to kg</span></a>
<a class="sourceLine" id="cb48-2" data-line-number="2">traits[[t]]<span class="op">$</span>default =<span class="st"> </span><span class="kw">get_ED_default</span>(PFT3_defaults_history, t)</a>
<a class="sourceLine" id="cb48-3" data-line-number="3"></a>
<a class="sourceLine" id="cb48-4" data-line-number="4"><span class="kw">prior_plot</span>(<span class="dt">prior =</span> traits[[t]]<span class="op">$</span>prior, </a>
<a class="sourceLine" id="cb48-5" data-line-number="5">           <span class="dt">q =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.975</span>),</a>
<a class="sourceLine" id="cb48-6" data-line-number="6">           <span class="dt">plot_default =</span> traits[[t]]<span class="op">$</span>default,</a>
<a class="sourceLine" id="cb48-7" data-line-number="7">           <span class="dt">title =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s(%s):</span><span class="ch">\n</span><span class="st">%s(%.4f, %.4f)&quot;</span>, t_long, t, </a>
<a class="sourceLine" id="cb48-8" data-line-number="8">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>distn, </a>
<a class="sourceLine" id="cb48-9" data-line-number="9">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>parama,</a>
<a class="sourceLine" id="cb48-10" data-line-number="10">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>paramb),</a>
<a class="sourceLine" id="cb48-11" data-line-number="11">           <span class="dt">type =</span> <span class="st">&quot;mixed&quot;</span>)  </a></code></pre></div>
<pre><code>## Warning: Removed 2500 rows containing non-finite values (stat_density).</code></pre>
<p><img src="Final_Book_files/figure-html/plot%20leaf_water_cap-1.png" width="672" /></p>
<hr />
</div>
</div>
<div id="leaf_psi_min-leaf-minimum-water-potential" class="section level2 unnumbered">
<h2><code>[leaf_psi_min]:</code> Leaf minimum water potential</h2>
<p>This is calculated from <code>[leaf_rwc_min]:</code> Leaf minimum relative water content or leaf residual fraction, which I have not added to BETY.</p>
<div id="ed-6" class="section level3 unnumbered">
<h3>ED</h3>
<ul>
<li>ED variable name : <code>leaf_psi_min</code></li>
<li>ED variable units: <code>m</code></li>
</ul>
</div>
<div id="bety-6" class="section level3 unnumbered">
<h3>BETY</h3>
<ul>
<li>Variable id: <code>1000000299</code></li>
<li>Prior id: <code>1000000392</code></li>
</ul>
<p>NOTE!! The units are NEGATIVE in the database
so we can calculate a distribution that is entirely negative.</p>
</div>
<div id="calculation-6" class="section level3 unnumbered">
<h3>Calculation</h3>
<div id="expert-elicitation-6" class="section level4 unnumbered">
<h4>Expert elicitation</h4>
<p>No expert elicitation provided by Brad Christoffersen.</p>
<p>I will use the equation in ED to calcualte the prior and
add min and max values to make sure the distribution
does not predict values that are not biologically possible.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1">t =<span class="st"> &quot;leaf_psi_min&quot;</span></a>
<a class="sourceLine" id="cb50-2" data-line-number="2">t_long =<span class="st"> &quot;Leaf minimum water potential &quot;</span></a>
<a class="sourceLine" id="cb50-3" data-line-number="3"></a>
<a class="sourceLine" id="cb50-4" data-line-number="4">i &lt;-<span class="st"> </span><span class="kw">which</span>(priors<span class="op">$</span>ED_name <span class="op">==</span><span class="st"> &quot;leaf_psi_min&quot;</span>)</a>
<a class="sourceLine" id="cb50-5" data-line-number="5"></a>
<a class="sourceLine" id="cb50-6" data-line-number="6"><span class="co"># Values added by Betsy and Felicien: c(-700, -0.1)</span></a>
<a class="sourceLine" id="cb50-7" data-line-number="7">priors[i,<span class="kw">c</span>(<span class="st">&quot;theor.min&quot;</span>, <span class="st">&quot;theor.max&quot;</span>)] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.1</span>,<span class="dv">700</span>)</a>
<a class="sourceLine" id="cb50-8" data-line-number="8"></a>
<a class="sourceLine" id="cb50-9" data-line-number="9"><span class="co"># Did Felicien mean 70 ?????</span></a>
<a class="sourceLine" id="cb50-10" data-line-number="10"><span class="co"># priors[which(priors$ED_name == &quot;leaf_psi_min&quot;),</span></a>
<a class="sourceLine" id="cb50-11" data-line-number="11"><span class="co">#        c(&quot;theor.min&quot;, &quot;theor.max&quot;)] &lt;- c(0.1,70) ## </span></a>
<a class="sourceLine" id="cb50-12" data-line-number="12"><span class="co"># No max value</span></a>
<a class="sourceLine" id="cb50-13" data-line-number="13"><span class="co"># priors[which(priors$ED_name == &quot;leaf_psi_min&quot;),</span></a>
<a class="sourceLine" id="cb50-14" data-line-number="14"><span class="co">#        c(&quot;theor.min&quot;, &quot;theor.max&quot;)] &lt;- c(0.1,NA) </span></a></code></pre></div>
<p>Code copied from ED:</p>
<pre><code>leaf_rwc_min = 0.01 * leaf_elastic_mod(ipft) + 0.17
leaf_psi_min = (leaf_rwc_min(ipft) - 1.) * leaf_water_sat(ipft) / leaf_water_cap(ipft)</code></pre>
</div>
<div id="conversion-6" class="section level4 unnumbered">
<h4>Conversion</h4>
<p>None</p>
</div>
</div>
<div id="code-6" class="section level3 unnumbered">
<h3>Code</h3>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1"><span class="co"># traits[[&quot;leaf_water_sat&quot;]]$prior</span></a>
<a class="sourceLine" id="cb52-2" data-line-number="2"></a>
<a class="sourceLine" id="cb52-3" data-line-number="3">temp_leaf_rwc_min_samp =<span class="st"> </span><span class="fl">0.01</span> <span class="op">*</span><span class="st"> </span>traits[[<span class="st">&quot;leaf_elastic_mod&quot;</span>]]<span class="op">$</span>prior <span class="op">+</span><span class="st"> </span><span class="fl">0.17</span></a>
<a class="sourceLine" id="cb52-4" data-line-number="4">temp_leaf_psi_min_samp =<span class="st"> </span>(temp_leaf_rwc_min_samp <span class="op">-</span><span class="st"> </span><span class="fl">1.</span>) <span class="op">*</span><span class="st"> </span>traits[[<span class="st">&quot;leaf_water_sat&quot;</span>]]<span class="op">$</span>prior <span class="op">/</span><span class="st"> </span>traits[[<span class="st">&quot;leaf_water_cap&quot;</span>]]<span class="op">$</span>prior</a>
<a class="sourceLine" id="cb52-5" data-line-number="5"></a>
<a class="sourceLine" id="cb52-6" data-line-number="6"><span class="co"># Add in the max an min from the priors table</span></a>
<a class="sourceLine" id="cb52-7" data-line-number="7"></a>
<a class="sourceLine" id="cb52-8" data-line-number="8">prior_in &lt;-<span class="st"> </span>priors[i,stats] <span class="op">*</span><span class="st"> </span>C<span class="op">$</span>MPa2m <span class="co"># Convert from MPa to m</span></a>
<a class="sourceLine" id="cb52-9" data-line-number="9">prior_in &lt;-<span class="st"> </span><span class="kw">prior_add_samp_data</span>(prior_in, <span class="dt">samp =</span> <span class="op">-</span>temp_leaf_psi_min_samp)</a>
<a class="sourceLine" id="cb52-10" data-line-number="10">prior_in[,stats] <span class="op">/</span><span class="st"> </span>C<span class="op">$</span>MPa2m</a></code></pre></div>
<pre><code>##   theor.min    low.025      low.25        mean      upp.75     upp.975
## 1       0.1 1.01633738 3.809536815 7.573818531 15.03741949 55.01960403
##   theor.max
## 1       700</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1">traits &lt;-<span class="st"> </span><span class="kw">fit_trait_dist</span>(bety, traits, t, prior_in, accepted_dists)</a></code></pre></div>
<p><img src="Final_Book_files/figure-html/calc%20leaf_psi_min-1.png" width="672" /></p>
<pre><code>## Entry with id = 1000000392 already exists.
## Parameters look the saaaaame.
## Old: lnorm(6.6500, 1.0200)
## New: lnorm(6.6500, 1.0200)</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1">traits[[t]]<span class="op">$</span>prior =<span class="st"> </span><span class="dv">-1</span> <span class="op">*</span><span class="st"> </span><span class="kw">rdistn</span>(traits[[t]]<span class="op">$</span>fit) <span class="co"># Remember to flip back over for psi</span></a>
<a class="sourceLine" id="cb56-2" data-line-number="2">traits[[t]]<span class="op">$</span>default =<span class="st"> </span><span class="kw">get_ED_default</span>(PFT3_defaults_history, t)</a>
<a class="sourceLine" id="cb56-3" data-line-number="3"></a>
<a class="sourceLine" id="cb56-4" data-line-number="4"><span class="kw">prior_plot</span>(<span class="dt">prior =</span> traits[[t]]<span class="op">$</span>prior, </a>
<a class="sourceLine" id="cb56-5" data-line-number="5">          <span class="dt">q =</span> <span class="kw">c</span>(.<span class="dv">025</span>,<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb56-6" data-line-number="6">           <span class="dt">plot_default =</span> traits[[t]]<span class="op">$</span>default,</a>
<a class="sourceLine" id="cb56-7" data-line-number="7">           <span class="dt">title =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s(%s):</span><span class="ch">\n</span><span class="st">%s(%.4f, %.4f)&quot;</span>, t_long, t, </a>
<a class="sourceLine" id="cb56-8" data-line-number="8">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>distn, </a>
<a class="sourceLine" id="cb56-9" data-line-number="9">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>parama,</a>
<a class="sourceLine" id="cb56-10" data-line-number="10">                           traits[[t]]<span class="op">$</span>fit<span class="op">$</span>paramb),</a>
<a class="sourceLine" id="cb56-11" data-line-number="11">           <span class="dt">type =</span> <span class="st">&quot;mixed&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: Removed 2500 rows containing non-finite values (stat_density).</code></pre>
<p><img src="Final_Book_files/figure-html/plot%20leaf_psi_min-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="constants.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="key-wood-traits.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
